name: Build APK

on:
  push:
    branches:
      - main
      - master

jobs:
  build:
    runs-on: ubuntu-latest

    steps:  
      - name: ğŸ“¥ Checkout repo  
        uses: actions/checkout@v4  

      - name: ğŸŸ¢ Setup Node  
        uses: actions/setup-node@v4  
        with:  
          node-version: 20  
          cache: 'yarn'  

      # 1ï¸âƒ£ INSTALA DEPENDÃŠNCIAS PRIMEIRO  
      - name: ğŸ“¦ Install deps  
        run: yarn install --frozen-lockfile  

      # 2ï¸âƒ£ PREBUILD AGORA FUNCIONA  
      - name: âš™ï¸ Expo prebuild  
        run: npx expo prebuild --platform android --non-interactive  

      # 3ï¸âƒ£ GERAR BUNDLE EMBED  
      - name: ğŸ“¦ Bundle JS  
        run: npx expo export:embed --platform android --dev false --eager  

      # 4ï¸âƒ£ PERMISSÃƒO GRADLE  
      - name: ğŸ”§ Give gradle permission  
        run: cd android && chmod +x gradlew  

      # 5ï¸âƒ£ BUILD RELEASE  
      - name: ğŸ—ï¸ Build APK  
        run: |
          cd android
          ./gradlew assembleRelease \
            --parallel \
            --configure-on-demand \
            --daemon \
            --offline

      # 6ï¸âƒ£ UPLOAD  
      - name: ğŸ“¤ Upload APK  
        uses: actions/upload-artifact@v4  
        with:  
          name: app-release  
          path: android/app/build/outputs/apk/release/*.apk
